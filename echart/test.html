<!-- The header of HTML page to use the Java script -->
<script src="js/jquery.min.js"></script>
<script src="js/echarts.common.min.js"></script>
<!-- The link to mention the css style of the website -->
<link rel="stylesheet" href="css/bootstrap.min.css">
<html>
<head>
	<!-- Mention the title of the website -->
<title>UseWaterWisely</title>
	<!-- Mention the shotcut icon for images -->
	<link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon" />
</head>
<body>
<!-- This part mention the header of main page panel -->
<div class="container">
	<div class="panel">
  	  	  <div class="panel-heading" style="background-color: #1f2d53;color: #fff;font-family: Quicksand,sans-serif;">
  	  	  	  <div class="panel-title">
				  <h3>
					  <!-- Add team logo to the website header -->
					  <img src="img/logo.png" style='max-height:50px;max-width:50px;'>
					  <!-- Add the website name to the website header -->
					  UseWaterWisely
					  <!-- Use the Javascript of build up the part of page title -->
					  <a href="javascript;" class="pull-right" data-toggle="modal" data-target="#helpDiv">
						  <i class="fa fa-question-circle-o"></i>
					  </a>
					  <!-- The first button to change the bar chart to cost analysis -->
					  <button type="button" class="btn btn-default" id="toCost" onClick="toCost();" style="border-radius: 0px;float:right;margin-top: 25px;">Cost Analysis</button>
					  <!-- The second button to change the bar chart to rainfall-rain off analysis -->
					  <button type="button" class="btn btn-default btn-primary" id="toMain" onClick="toMain();" style="border-radius: 0px;float:right;margin-top: 25px;">Run-off Estimation</button>
				  </h3>
  	  	  	  </div>
  	  	  </div>

  	  	  <div class="panel-body">
				<div class="form-group">
					<div class="col-md-4" style="background: #37bec9;padding-bottom: 15px;font-size: 12px;">
						<h4>Know about the water resources for your residence</h4>
						<label style="margin-top: 5px;">Type in your suburb name</label>
						<div class="input-group">
							<input type="text" id="localization" class="form-control">
						</div>
						<label style="margin-top: 5px;">Type in your tank capacity</label>
						<div class="input-group">
							<input type="text" id="waterLitre" class="form-control">
							<div class="input-group-addon">Litres</div>
						</div>
						<button type="button" class="btn btn-default btn-primary" onClick="notank(this);" style="margin-top:10px">No tank</button><br>
						<label style="margin-top: 5px;">Type in your roof area (default: 50)</label>
						<div class="input-group">
							<input type="text" id="area" class="form-control">
							<div class="input-group-addon">m&sup2; </div>
						</div>
						<button type="button" class="btn btn-default btn-primary" onClick="noRoof(this);" style="margin-top:10px">Do not know Roof Area</button><br>
						<br>
						<button type="button" id="submitAPI" class="btn btn-default btn-primary" onClick="submitAPI();" style="float:right">Submit</button>
					</div>
			  		<div class="col-md-8" id="mainText" >
						<h1 style="font-size:300%;">Welcome to UseWaterWisely!</h1>


						<p style="font-size:160%;">This website's motive is to guide suburban gardeners on the water resources available for their garden and plan the usage of resources effectively.
							To start with, provide your suburb, water tank details and your house roof area, to calculate the run-off water amount for your tank and the water-usage cost when you buy the run-off water from a Metropolitan Water provider
						</p>


					</div>
				</div>
			</div>
		</div>
		<div class="panel-footer" style="background-color: #1f2d53;color: #fff;font-family: Quicksand,sans-serif;"> &copy; Copyright by The Superflys 2017 - Monash University Industry Project - All rights reserved.</div>
</div>
</body>
<script>
	toMain();
function submitAPI()
{
	$("#localization").blur();
	$("#waterLitre").blur();
	$("#area").blur();
	if ($("#localization").hasClass("invalid"))
	{
		alert("Warning: Please input a valid suburb")
		return false;
	}
	if ($("#localization").val() != '' && $("#localization").val() != null && $("#localization").val().length < 3)
	{
		alert("Warning: Input at least 3 leters for location search");
		return false;
	}
	if ($("#waterLitre").val() != '' && $("#waterLitre").val() != null && $("#waterLitre").val() > 50000)
	{
		alert("Warning: The maximum tank capacity is 50000, please check!");
		return false;
	}
	if ($("#area").val() != '' && $("#area").val() != null && $("#area").val() > 1000)
	{
		alert("Warning: The maximum roof area is 1000 square meter");
		return false;
	}
	if (!$("#waterLitre").hasClass("haveTank") && $("#waterLitre").val() == '')
	{
		alert("Warning: Type in a valid number. If you do not have a tank, click on 'NO TANK' button");
		return false;
	}
	if (!$("#area").hasClass("haveRoof") && $("#area").val() == '')
	{
		alert("Warning: Type in a valid number. If you do not know your roof area, click on 'Do not know' button, default value of 50m2 will be taken");
		return false;
	}
	if ($("#waterLitre").hasClass("invalid") || $("#area").hasClass("invalid"))
	{
		alert("Warning: Please input only numbers")
		return false;	
	}
	var jsondata = null;
    $.ajax({
        type: "POST",
        url: "http://localhost:8000/api/searchlocation",
        contentType: "application/json; charset=utf-8",
        data: JSON.stringify(GetJsonData()),
        dataType: "json",
        //jsonpCallback: "jsonpcallback",
        async: false,
        success: function(data)
		{
			if(data.locations == null || data.locations.length == 0)
					alert("Warning: Please input valid suburb name");
			else
				jsondata = data.locations;
		},
        error: function (message) {
        	alert(message);
        }
    });
	if (jsondata == null || jsondata.length == 0)
			return false;
	$("#mainText").html("");
	$("#mainText").append('<label style="margin-top: 5px;" class="rainfall">This chart gives an estimate of your tank level based on the average rainfall in your location and your roof area.</label>');
	$("#mainText").append('<label style="margin-top: 5px;" class="costchat">This chart gives a comparison of cost when you buy the same amount of run-off water from a water provider. Different metropolitan water providers are shown here. </label>');
	var nameList = new Array(jsondata.length);
	var numList = new Array(jsondata.length);
	for (var i = 0; i < jsondata.length; i++)
	{
		nameList[i] = (jsondata[i].station_name);
	}
	var countNum = 0;
	for (var j = 0; j < jsondata.length; j++)
	{
		var id = (jsondata[j].station_id);
		var htmlContent = null;
		$.ajax({
			type: "POST",
			url: "http://localhost:8000/api/getrunoffamount",
			contentType: "application/json; charset=utf-8",
			data: JSON.stringify(getJsonDate2(id)),
			dataType: "json",
			//jsonpCallback: "jsonpcallback",
			async: false,
			success: function(data)
			{
				var text = data;
				if( text[0] == null)
					return false;
				var rainfall = new Array();
				var runoff = new Array();
				var cost = new Array();
				var cost2 = new Array();
				var cost3 = new Array();
				var cost4 = new Array();
				var tanklat = $("#waterLitre").val();
				if (tanklat == '' || tanklat == null)
					tanklat = 0;
				var tanks = [tanklat, tanklat, tanklat, tanklat, tanklat, tanklat, tanklat, tanklat, tanklat, tanklat, tanklat,tanklat];
				var roofArea = $("#area").val();
				if (roofArea == '')
					roofArea = 50;
                if (text[0] != null){ rainfall[0] = text[0].rainfall; runoff[0] = text[0].runoff;cost[0] = runoff[0]*2.3932;
                    cost2[0] = runoff[0]*2.5993;cost3[0] = runoff[0]*2.6097;cost4[0]=runoff[0]*1.7058;}
                if (text[1] != null){ rainfall[1] = text[1].rainfall; runoff[1] = text[1].runoff;cost[1] = runoff[1]*2.3932;
                    cost2[1] = runoff[1]*2.5993;cost3[1] = runoff[1]*2.6097;cost4[1]=runoff[1]*1.7058;}
                if (text[2] != null){ rainfall[2] = text[2].rainfall; runoff[2] = text[2].runoff;cost[2] = runoff[2]*2.3932;
                    cost2[2] = runoff[2]*2.5993;cost3[2] = runoff[2]*2.6097;cost4[2]=runoff[2]*1.7058;}
                if (text[3] != null){ rainfall[3] = text[3].rainfall; runoff[3] = text[3].runoff;cost[3] = runoff[3]*2.3932;
                    cost2[3] = runoff[3]*2.5993;cost3[3] = runoff[3]*2.6097;cost4[3]=runoff[3]*1.7058;}
                if (text[4] != null){ rainfall[4] = text[4].rainfall; runoff[4] = text[4].runoff;cost[4] = runoff[4]*2.3932;
                    cost2[4] = runoff[4]*2.5993;cost3[4] = runoff[4]*2.6097;cost4[4]=runoff[4]*1.7058;}
                if (text[5] != null){ rainfall[5] = text[5].rainfall; runoff[5] = text[5].runoff;cost[5] = runoff[5]*2.3932;
                    cost2[5] = runoff[5]*2.5993;cost3[5] = runoff[5]*2.6097;cost4[5]=runoff[5]*1.7058;}
                if (text[6] != null){ rainfall[6] = text[6].rainfall; runoff[6] = text[6].runoff;cost[6] = runoff[6]*2.3932;
                    cost2[6] = runoff[6]*2.5993;cost3[6] = runoff[6]*2.6097;cost4[6]=runoff[6]*1.7058;}
                if (text[7] != null){ rainfall[7] = text[7].rainfall; runoff[7] = text[7].runoff;cost[7] = runoff[7]*2.3932;
                    cost2[7] = runoff[7]*2.5993;cost3[7] = runoff[7]*2.6097;cost4[7]=runoff[7]*1.7058;}
                if (text[8] != null){ rainfall[8] = text[8].rainfall; runoff[8] = text[8].runoff;cost[8] = runoff[8]*2.3932;
                    cost2[8] = runoff[8]*2.5993;cost3[8] = runoff[8]*2.6097;cost4[8]=runoff[8]*1.7058;}
                if (text[9] != null){ rainfall[9] = text[9].rainfall; runoff[9] = text[9].runoff;cost[9] = runoff[9]*2.3932;
                    cost2[9] = runoff[9]*2.5993;cost3[9] = runoff[9]*2.6097;cost4[9]=runoff[9]*1.7058;}
                if (text[10] != null){ rainfall[10] = text[10].rainfall; runoff[10] = text[10].runoff;cost[10] = runoff[10]*2.3932;
                    cost2[10] = runoff[10]*2.5993;cost3[10] = runoff[10]*2.6097;cost4[10]=runoff[10]*1.7058;}
                if (text[11] != null){ rainfall[11] = text[11].rainfall; runoff[11] = text[11].runoff;cost[11] = runoff[11]*2.3932;
                    cost2[11] = runoff[11]*2.5993;cost3[11] = runoff[11]*2.6097;cost4[11]=runoff[11]*1.7058;}
				$("#mainText").append('<div id="main_'+countNum+'" class="rainfall" style="height:450px;"></div>');
				$("#mainText").append('<div id="lain_'+countNum+'" class="costchat" style="height:450px;"></div>');
				var chart = echarts.init(document.getElementById('main_' + countNum));
				var chart2 = echarts.init(document.getElementById('lain_' + countNum));
				countNum++;
				var options = {
					color: ['#1f2d53','#3398DB','#EA2F10'],
					title: {
						text: 'Rainfall run-off chart -' +  nameList[j],
						textStyle: {fontSize:12}
					},
					tooltip: {},
					legend: {
						right: 10,
						data:['rainfall','runoff','tank capacity']
					},

					xAxis: {
						name:'Month',
						data: ["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"]
					},
					yAxis: {name:'Litres'},
					series: [{
						name: 'rainfall',
						type: 'bar',
						data: rainfall
					},{
						name: 'runoff',
						type: 'bar',
						data: runoff
					}, {
						name:'tank capacity',
						type: 'line',
						data: tanks
					}
					]
				};
				var options2 = {
					color: ['#1f2d53','#3398DB','#43AC6A','#EA2F10'],
					title: {
						text: 'Cost chart\n -' +  nameList[j],
						textStyle: {fontSize:12}
					},
					tooltip: {},
					legend: {
						right: 20,

						data:['City West Water', 'Yarra Valley Water', 'South East Water', 'Western Water']
					},
                    grid: { // 控制图的大小，调整下面这些值就可以，
                        x: 100,
                        y:100,
                        x2: 100,
                        y2: 100,// y2可以控制 X轴跟Zoom控件之间的间隔，避免以为倾斜后造成 label重叠到zoom上
                    },
					xAxis: {
						name:'Month',
						data: ["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"]
					},
					yAxis: {name:'Dolars'},
					series: [{
						name: 'City West Water',
						type: 'bar',
						data: cost
					},
						{
							name: 'Yarra Valley Water',
							type: 'bar',
							data: cost2
						},
						{
							name: 'South East Water',
							type: 'bar',
							data: cost3
						},
						{
							name: 'Western Water',
							type: 'bar',
							data: cost4
						}
					]
				};
				chart.setOption(options);
				chart2.setOption(options2);
			},
			error: function (message) {
				htmlContent = message;
			}
		});
	}
	toMain();
	if (countNum == 0)
			alert("Warning: Please input valid suburb name");

}
function getJsonDate2(id)
{
	var strr = ""+id;
	var roofArea = $("#area").val();
	if (roofArea == '')
		roofArea = "50";
	var json = {
		"station_id": strr,
		"roof_area" : roofArea
	};
	return json;
}

	function toMain()
	{
		$(".rainfall").show();
		$(".costchat").hide();
		$("#toMain").addClass("btn-primary");
		$("#toMain").addClass("active");
		$("#toCost").removeClass("btn-primary");
		$("#toCost").removeClass("active");
	}
	function toCost()
	{
		$(".rainfall").hide();
		$(".costchat").show();
		$("#toMain").removeClass("btn-primary");
		$("#toMain").removeClass("active");
		$("#toCost").addClass("btn-primary");
		$("#toCost").addClass("active");
	}
$("#waterLitre").blur(
		function(){
			var varText = $("#waterLitre").val();
			if(/^[0-9.]*$/.test(varText))
			{
				$("#waterLitre").css("background-color", "white");
				$("#waterLitre").removeClass("invalid");
			}
			else
			{
				$("#waterLitre").css("background-color", "#FFE1E1");
				$("#waterLitre").addClass("invalid");
			}
		});

$("#localization").blur(
		function(){
			var varText = $("#localization").val();
			if(/^[A-Za-z]+$/.test(varText))
			{
				$("#localization").css("background-color", "white");
				$("#localization").removeClass("invalid");
			}
			else
			{
				$("#localization").css("background-color", "#FFE1E1");
				$("#localization").addClass("invalid");
			}
		});
		
function notank(obj)
	{
		if(!$("#waterLitre").hasClass("haveTank"))
		{
			$("#waterLitre").val("");
			$("#waterLitre").css("background-color", "white");
			$("#waterLitre").removeClass("invalid");
			$("#waterLitre").addClass("haveTank");
			$(obj).text("Have Tank");
			$("#waterLitre").attr("disabled",true);
		}
		else
		{
			$("#waterLitre").val("");
			$("#waterLitre").css("background-color", "white");
			$("#waterLitre").removeClass("invalid");
			$("#waterLitre").removeClass("haveTank");
			$(obj).text("No Tank");
			$("#waterLitre").attr("disabled",false);
		}
	}
	function noRoof(obj)
	{
		if(!$("#area").hasClass("haveRoof"))
		{
			$("#area").val("");
			$("#area").css("background-color", "white");
			$("#area").removeClass("invalid");
			$("#area").addClass("haveRoof");
			$(obj).text("Know Roof Area");
			$("#area").attr("disabled",true);
		}
		else
		{
			$("#area").val("");
			$("#area").css("background-color", "white");
			$("#area").removeClass("invalid");
			$("#area").removeClass("haveRoof");
			$(obj).text("Dont Know Roof Area");
			$("#area").attr("disabled",false);
		}
	}
$("#area").blur(
		function(){
			var varText = $("#area").val();
			if(/^[0-9.]*$/.test(varText))
			{
				$("#area").css("background-color", "white");
				$("#area").removeClass("invalid");
			}
			else
			{
				$("#area").css("background-color", "#FFE1E1");
				$("#area").addClass("invalid");
			}
		});

function GetJsonData() {
	var localization = $("#localization").val();
    var json = {
        "location": localization
    };
    return json;
}
</script>
</html>